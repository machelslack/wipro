'use strict';

(function () {
  'use strict';

  var app = {
    todaysDate: new Date(),
    isLoading: true,
    forcastData: {},
    spinner: document.querySelector('.loader'),
    cardTemplate: document.querySelector('.cardTemplate'),
    container: document.querySelector('.main'),
    daysOfWeek: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
  };

  app.updateForecastCard = function (data) {

    var dataLastUpdated = new Date(data.created);
    var sunrise = data.channel.astronomy.sunrise;
    var sunset = data.channel.astronomy.sunset;
    var current = data.channel.item.condition;
    var humidity = data.channel.atmosphere.humidity;
    var wind = data.channel.wind;
    app.cardTemplate.querySelector('.description').textContent = current.text;
    app.cardTemplate.querySelector('.date').textContent = current.date;
    app.cardTemplate.querySelector('.current .icon').classList.add(app.getIconClass(current.code));
    app.cardTemplate.querySelector('.current .temperature .value').textContent = Math.round(current.temp);
    app.cardTemplate.querySelector('.current .sunrise').textContent = sunrise;
    app.cardTemplate.querySelector('.current .sunset').textContent = sunset;
    app.cardTemplate.querySelector('.current .humidity').textContent = Math.round(humidity) + '%';
    app.cardTemplate.querySelector('.current .wind .value').textContent = Math.round(wind.speed);
    app.cardTemplate.querySelector('.current .wind .direction').textContent = wind.direction;
    var nextDays = cardTemplate.querySelectorAll('.future .oneday');
    var today = new Date();
    today = today.getDay();
    for (var i = 0; i < 5; i++) {
      var nextDay = nextDays[i];
      var daily = data.channel.item.forecast[i];
      if (daily && nextDay) {
        nextDay.querySelector('.date').textContent = app.daysOfWeek[i + today];
        nextDay.querySelector('.icon').classList.add(app.getIconClass(daily.code));
        nextDay.querySelector('.temp-high .value').textContent = Math.round(daily.high);
        nextDay.querySelector('.temp-low .value').textContent = Math.round(daily.low);
      }
    }
    if (app.isLoading) {
      app.spinner.setAttribute('hidden', true);
      app.container.removeAttribute('hidden');
      app.isLoading = false;
    }
  };

  app.getIconClass = function (weatherCode) {

    weatherCode = parseInt(weatherCode);
    switch (weatherCode) {
      case 25:
      case 32:
      case 33:
      case 34:
      case 36:
      case 3200:
        return 'clear-day';
      case 0:
      case 1:
      case 2:
      case 6:
      case 8:
      case 9:
      case 10:
      case 11:
      case 12:
      case 17:
      case 35:
      case 40:
        return 'rain';
      case 3:
      case 4:
      case 37:
      case 38:
      case 39:
      case 45:
      case 47:
        return 'thunderstorms';
      case 5:
      case 7:
      case 13:
      case 14:
      case 16:
      case 18:
      case 41:
      case 42:
      case 43:
      case 46:
        return 'snow';
      case 15:
      case 19:
      case 20:
      case 21:
      case 22:
        return 'fog';
      case 24:
      case 23:
        return 'windy';
      case 26:
      case 27:
      case 28:
      case 31:
        return 'cloudy';
      case 29:
      case 30:
      case 44:
        return 'partly-cloudy-day';
    }
  };

  app.getForcast = function (city) {

    var url = 'https://api.openweathermap.org/data/2.5/forecast?q=' + city + '&mode=json&appid=2bd757f23ca948f1953dc3f99d6b3c57';

    var xhr = new XMLHttpRequest();
    xhr.onload = function () {

      app.forcastData = JSON.parse(this.responseText);
      app.decontructData(app.forcastData);
    };

    xhr.open('GET', url, true);
    xhr.send();
  };

  app.decontructData = function (data) {
    var fiveDays = data.list;

    var days = [];

    var _loop = function _loop(counter) {

      var marker = app.todaysDate.getDate() + counter;

      days.push(fiveDays.filter(function (element) {

        var date = new Date(element.dt_txt).getDate();

        return date === marker;
      }));
    };

    for (var counter = 0; counter < 5; counter++) {
      _loop(counter);
    };

    app.updateForecastCard(app.initialiseForecast(days));
  };

  app.initialiseForecast = function (days) {

    var forecast = [];

    days.forEach(function (element, index) {

      var min = 0,
          max = 0,
          item = "",
          compare = -1,
          current = {},
          weather = [],
          counts = {};

      var dayArray = element;

      dayArray.forEach(function (innerElement, index) {

        var marker = index + 1;

        marker < dayArray.length ? app.todaysDate <= new Date(innerElement.dt_txt) || app.todaysDate >= new Date(innerElement.dt_txt) && app.todaysDate <= new Date(dayArray[marker].dt_txt) ? current = innerElement : null : null;

        index === 0 ? min = innerElement.main.temp_min : min = innerElement.main.temp_min <= min ? min : innerElement.main.temp_min;

        index === 0 ? max = innerElement.main.temp_max : max = innerElement.main.temp_max >= max ? max : innerElement.main.temp_max;

        var code = innerElement.weather[0].icon;

        counts[code] = counts[code] === undefined ? 1 : counts[code] + 1;

        counts[code] > compare ? (compare = counts[code], item = { current: current, code: innerElement.weather[0].icon.replace(/[a-z]/, ''),

          high: (max - 273.15) * 9 / 5 + 32,

          low: (min - 273.15) * 9 / 5 + 32 }) : null;
      });

      forecast.push(item);
    });

    var initialWeatherForecast = {

      key: app.forcastData.city.id,
      label: app.forcastData.city.name,
      created: new Date(),
      channel: {
        astronomy: {
          sunrise: "",
          sunset: ""
        },
        item: {
          condition: {
            text: forecast[0].current.weather[0].main,
            date: new Date(forecast[0].current.dt_txt),
            temp: (forecast[0].current.main.temp - 273.15) * 9 / 5 + 32,
            code: forecast[0].current.weather[0].icon.replace(/[a-z]/, '')
          },
          forecast: forecast
        },
        atmosphere: {
          humidity: forecast[0].current.main.humidity
        },
        wind: {
          speed: forecast[0].current.wind.speed,
          direction: ""
        }
      }
    };

    return initialWeatherForecast;
  };

  app.getForcast('London');
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiYXBwIiwidG9kYXlzRGF0ZSIsIkRhdGUiLCJpc0xvYWRpbmciLCJmb3JjYXN0RGF0YSIsInNwaW5uZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjYXJkVGVtcGxhdGUiLCJjb250YWluZXIiLCJkYXlzT2ZXZWVrIiwidXBkYXRlRm9yZWNhc3RDYXJkIiwiZGF0YSIsImRhdGFMYXN0VXBkYXRlZCIsImNyZWF0ZWQiLCJzdW5yaXNlIiwiY2hhbm5lbCIsImFzdHJvbm9teSIsInN1bnNldCIsImN1cnJlbnQiLCJpdGVtIiwiY29uZGl0aW9uIiwiaHVtaWRpdHkiLCJhdG1vc3BoZXJlIiwid2luZCIsInRleHRDb250ZW50IiwidGV4dCIsImRhdGUiLCJjbGFzc0xpc3QiLCJhZGQiLCJnZXRJY29uQ2xhc3MiLCJjb2RlIiwiTWF0aCIsInJvdW5kIiwidGVtcCIsInNwZWVkIiwiZGlyZWN0aW9uIiwibmV4dERheXMiLCJxdWVyeVNlbGVjdG9yQWxsIiwidG9kYXkiLCJnZXREYXkiLCJpIiwibmV4dERheSIsImRhaWx5IiwiZm9yZWNhc3QiLCJoaWdoIiwibG93Iiwic2V0QXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwid2VhdGhlckNvZGUiLCJwYXJzZUludCIsImdldEZvcmNhc3QiLCJjaXR5IiwidXJsIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvbmxvYWQiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJkZWNvbnRydWN0RGF0YSIsIm9wZW4iLCJzZW5kIiwiZml2ZURheXMiLCJsaXN0IiwiZGF5cyIsImNvdW50ZXIiLCJtYXJrZXIiLCJnZXREYXRlIiwicHVzaCIsImZpbHRlciIsImVsZW1lbnQiLCJkdF90eHQiLCJpbml0aWFsaXNlRm9yZWNhc3QiLCJmb3JFYWNoIiwiaW5kZXgiLCJtaW4iLCJtYXgiLCJjb21wYXJlIiwid2VhdGhlciIsImNvdW50cyIsImRheUFycmF5IiwiaW5uZXJFbGVtZW50IiwibGVuZ3RoIiwibWFpbiIsInRlbXBfbWluIiwidGVtcF9tYXgiLCJpY29uIiwidW5kZWZpbmVkIiwicmVwbGFjZSIsImluaXRpYWxXZWF0aGVyRm9yZWNhc3QiLCJrZXkiLCJpZCIsImxhYmVsIiwibmFtZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxDQUFDLFlBQVc7QUFBRTs7QUFFVixNQUFNQSxNQUFNO0FBQ1pDLGdCQUFZLElBQUlDLElBQUosRUFEQTtBQUVaQyxlQUFXLElBRkM7QUFHWkMsaUJBQVksRUFIQTtBQUlaQyxhQUFTQyxTQUFTQyxhQUFULENBQXVCLFNBQXZCLENBSkc7QUFLWkMsa0JBQWNGLFNBQVNDLGFBQVQsQ0FBdUIsZUFBdkIsQ0FMRjtBQU1aRSxlQUFXSCxTQUFTQyxhQUFULENBQXVCLE9BQXZCLENBTkM7QUFPWkcsZ0JBQVksQ0FBRSxLQUFGLEVBQVEsS0FBUixFQUFlLEtBQWYsRUFBc0IsS0FBdEIsRUFBNkIsS0FBN0IsRUFBb0MsS0FBcEMsRUFBMkMsS0FBM0M7QUFQQSxHQUFaOztBQVVBVixNQUFJVyxrQkFBSixHQUF5QixVQUFDQyxJQUFELEVBQVU7O0FBRW5DLFFBQUlDLGtCQUFrQixJQUFJWCxJQUFKLENBQVNVLEtBQUtFLE9BQWQsQ0FBdEI7QUFDQSxRQUFJQyxVQUFVSCxLQUFLSSxPQUFMLENBQWFDLFNBQWIsQ0FBdUJGLE9BQXJDO0FBQ0EsUUFBSUcsU0FBU04sS0FBS0ksT0FBTCxDQUFhQyxTQUFiLENBQXVCQyxNQUFwQztBQUNBLFFBQUlDLFVBQVVQLEtBQUtJLE9BQUwsQ0FBYUksSUFBYixDQUFrQkMsU0FBaEM7QUFDQSxRQUFJQyxXQUFXVixLQUFLSSxPQUFMLENBQWFPLFVBQWIsQ0FBd0JELFFBQXZDO0FBQ0EsUUFBSUUsT0FBT1osS0FBS0ksT0FBTCxDQUFhUSxJQUF4QjtBQUNBeEIsUUFBSVEsWUFBSixDQUFpQkQsYUFBakIsQ0FBK0IsY0FBL0IsRUFBK0NrQixXQUEvQyxHQUE2RE4sUUFBUU8sSUFBckU7QUFDQTFCLFFBQUlRLFlBQUosQ0FBaUJE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QlEsSUFBL0IsQ0FBb0NFLE9BQXBDLENBQTRDLE9BQTVDLEVBQW9ELEVBQXBEO0FBSkcsV0FEUDtBQU9ON0Msb0JBQVNBO0FBUEgsU0FMQztBQWNUckIsb0JBQVk7QUFDUkQsb0JBQVVzQixTQUFTLENBQVQsRUFBWXpCLE9BQVosQ0FBb0JpRSxJQUFwQixDQUF5QjlEO0FBRDNCLFNBZEg7QUFpQlBFLGNBQU07QUFDSlcsaUJBQU9TLFNBQVMsQ0FBVCxFQUFZekIsT0FBWixDQUFvQkssSUFBcEIsQ0FBeUJXLEtBRDVCO0FBRUpDLHFCQUFXO0FBRlA7QUFqQkM7QUFMb0IsS0FBL0I7O0FBNkJGLFdBQU9zRCxzQkFBUDtBQUVDLEdBOUVEOztBQWlGQTFGLE1BQUltRCxVQUFKLENBQWUsUUFBZjtBQUdDLENBNVBEIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7ICd1c2Ugc3RyaWN0JztcblxuICAgIGNvbnN0IGFwcCA9IHtcbiAgICB0b2RheXNEYXRlOiBuZXcgRGF0ZSgpLFxuICAgIGlzTG9hZGluZzogdHJ1ZSxcbiAgICBmb3JjYXN0RGF0YTp7fSxcbiAgICBzcGlubmVyOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9hZGVyJyksXG4gICAgY2FyZFRlbXBsYXRlOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZFRlbXBsYXRlJyksXG4gICAgY29udGFpbmVyOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFpbicpLFxuICAgIGRheXNPZldlZWs6IFsgJ1N1bicsJ01vbicsICdUdWUnLCAnV2VkJywgJ1RodScsICdGcmknLCAnU2F0J11cbiAgfTtcblxuICAgIGFwcC51cGRhdGVGb3JlY2FzdENhcmQgPSAoZGF0YSkgPT4ge1xuXG4gICAgbGV0IGRhdGFMYXN0VXBkYXRlZCA9IG5ldyBEYXRlKGRhdGEuY3JlYXRlZCk7XG4gICAgbGV0IHN1bnJpc2UgPSBkYXRhLmNoYW5uZWwuYXN0cm9ub215LnN1bnJpc2U7XG4gICAgbGV0IHN1bnNldCA9IGRhdGEuY2hhbm5lbC5hc3Ryb25vbXkuc3Vuc2V0O1xuICAgIGxldCBjdXJyZW50ID0gZGF0YS5jaGFubmVsLml0ZW0uY29uZGl0aW9uO1xuICAgIGxldCBodW1pZGl0eSA9IGRhdGEuY2hhbm5lbC5hdG1vc3BoZXJlLmh1bWlkaXR5O1xuICAgIGxldCB3aW5kID0gZGF0YS5jaGFubmVsLndpbmQ7XG4gICAgYXBwLmNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKS50ZXh0Q29udGVudCA9IGN1cnJlbnQudGV4dDtcbiAgICBhcHAuY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5kYXRlJykudGV4dENvbnRlbnQgPSBjdXJyZW50LmRhdGU7XG4gICAgYXBwLmNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKCcuY3VycmVudCAuaWNvbicpLmNsYXNzTGlzdC5hZGQoYXBwLmdldEljb25DbGFzcyhjdXJyZW50LmNvZGUpKTtcbiAgICBhcHAuY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5jdXJyZW50IC50ZW1wZXJhdHVyZSAudmFsdWUnKS50ZXh0Q29udGVudCA9XG4gICAgICBNYXRoLnJvdW5kKGN1cnJlbnQudGVtcCk7XG4gICAgYXBwLmNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKCcuY3VycmVudCAuc3VucmlzZScpLnRleHRDb250ZW50ID0gc3VucmlzZTtcbiAgICBhcHAuY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5jdXJyZW50IC5zdW5zZXQnKS50ZXh0Q29udGVudCA9IHN1bnNldDtcbiAgICBhcHAuY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5jdXJyZW50IC5odW1pZGl0eScpLnRleHRDb250ZW50ID1cbiAgICAgIE1hdGgucm91bmQoaHVtaWRpdHkpICsgJyUnO1xuICAgIGFwcC5jYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcignLmN1cnJlbnQgLndpbmQgLnZhbHVlJykudGV4dENvbnRlbnQgPVxuICAgICAgTWF0aC5yb3VuZCh3aW5kLnNwZWVkKTtcbiAgICBhcHAuY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5jdXJyZW50IC53aW5kIC5kaXJlY3Rpb24nKS50ZXh0Q29udGVudCA9IHdpbmQuZGlyZWN0aW9uO1xuICAgIGxldCBuZXh0RGF5cyA9IGNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yQWxsKCcuZnV0dXJlIC5vbmVkYXknKTtcbiAgICBsZXQgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuICAgIHRvZGF5ID0gdG9kYXkuZ2V0RGF5KCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcbiAgICAgIGxldCBuZXh0RGF5ID0gbmV4dERheXNbaV07XG4gICAgICBsZXQgZGFpbHkgPSBkYXRhLmNoYW5uZWwuaXRlbS5mb3JlY2FzdFtpXTtcbiAgICAgIGlmIChkYWlseSAmJiBuZXh0RGF5KSB7XG4gICAgICAgIG5leHREYXkucXVlcnlTZWxlY3RvcignLmRhdGUnKS50ZXh0Q29udGVudCA9XG4gICAgICAgICAgYXBwLmRheXNPZldlZWtbKGkgKyB0b2RheSldO1xuICAgICAgICBuZXh0RGF5LnF1ZXJ5U2VsZWN0b3IoJy5pY29uJykuY2xhc3NMaXN0LmFkZChhcHAuZ2V0SWNvbkNsYXNzKGRhaWx5LmNvZGUpKTtcbiAgICAgICAgbmV4dERheS5xdWVyeVNlbGVjdG9yKCcudGVtcC1oaWdoIC52YWx1ZScpLnRleHRDb250ZW50ID1cbiAgICAgICAgICBNYXRoLnJvdW5kKGRhaWx5LmhpZ2gpO1xuICAgICAgICBuZXh0RGF5LnF1ZXJ5U2VsZWN0b3IoJy50ZW1wLWxvdyAudmFsdWUnKS50ZXh0Q29udGVudCA9XG4gICAgICAgICAgTWF0aC5yb3VuZChkYWlseS5sb3cpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoYXBwLmlzTG9hZGluZykge1xuICAgICAgYXBwLnNwaW5uZXIuc2V0QXR0cmlidXRlKCdoaWRkZW4nLCB0cnVlKTtcbiAgICAgIGFwcC5jb250YWluZXIucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgIGFwcC5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICB9XG4gIH07XG5cbmFwcC5nZXRJY29uQ2xhc3MgPSAod2VhdGhlckNvZGUpID0+ICB7XG5cbiAgICB3ZWF0aGVyQ29kZSA9IHBhcnNlSW50KHdlYXRoZXJDb2RlKTtcbiAgICBzd2l0Y2ggKHdlYXRoZXJDb2RlKSB7XG4gICAgICBjYXNlIDI1OiBcbiAgICAgIGNhc2UgMzI6IFxuICAgICAgY2FzZSAzMzogXG4gICAgICBjYXNlIDM0OiBcbiAgICAgIGNhc2UgMzY6IFxuICAgICAgY2FzZSAzMjAwOiBcbiAgICAgICAgcmV0dXJuICdjbGVhci1kYXknO1xuICAgICAgY2FzZSAwOiBcbiAgICAgIGNhc2UgMTogXG4gICAgICBjYXNlIDI6IFxuICAgICAgY2FzZSA2OiBcbiAgICAgIGNhc2UgODogXG4gICAgICBjYXNlIDk6IFxuICAgICAgY2FzZSAxMDogXG4gICAgICBjYXNlIDExOiBcbiAgICAgIGNhc2UgMTI6IFxuICAgICAgY2FzZSAxNzogXG4gICAgICBjYXNlIDM1OiBcbiAgICAgIGNhc2UgNDA6IFxuICAgICAgICByZXR1cm4gJ3JhaW4nO1xuICAgICAgY2FzZSAzOlxuICAgICAgY2FzZSA0OlxuICAgICAgY2FzZSAzNzogXG4gICAgICBjYXNlIDM4OiBcbiAgICAgIGNhc2UgMzk6IFxuICAgICAgY2FzZSA0NTogXG4gICAgICBjYXNlIDQ3OlxuICAgICAgICByZXR1cm4gJ3RodW5kZXJzdG9ybXMnO1xuICAgICAgY2FzZSA1OiBcbiAgICAgIGNhc2UgNzogXG4gICAgICBjYXNlIDEzOiBcbiAgICAgIGNhc2UgMTQ6IFxuICAgICAgY2FzZSAxNjogXG4gICAgICBjYXNlIDE4OiBcbiAgICAgIGNhc2UgNDE6IFxuICAgICAgY2FzZSA0MjogXG4gICAgICBjYXNlIDQzOiBcbiAgICAgIGNhc2UgNDY6IFxuICAgICAgICByZXR1cm4gJ3Nub3cnO1xuICAgICAgY2FzZSAxNTogXG4gICAgICBjYXNlIDE5OiBcbiAgICAgIGNhc2UgMjA6IFxuICAgICAgY2FzZSAyMTogXG4gICAgICBjYXNlIDIyOiBcbiAgICAgICAgcmV0dXJuICdmb2cnO1xuICAgICAgY2FzZSAyNDogXG4gICAgICBjYXNlIDIzOiBcbiAgICAgICAgcmV0dXJuICd3aW5keSc7XG4gICAgICBjYXNlIDI2OiBcbiAgICAgIGNhc2UgMjc6IFxuICAgICAgY2FzZSAyODogXG4gICAgICBjYXNlIDMxOiBcbiAgICAgICAgcmV0dXJuICdjbG91ZHknO1xuICAgICAgY2FzZSAyOTogXG4gICAgICBjYXNlIDMwOiBcbiAgICAgIGNhc2UgNDQ6IFxuICAgICAgICByZXR1cm4gJ3BhcnRseS1jbG91ZHktZGF5JztcbiAgICB9XG4gIH07XG5cblxuYXBwLmdldEZvcmNhc3QgPSAoY2l0eSkgPT57XG5cblxubGV0IHVybCA9IGBodHRwczovL2FwaS5vcGVud2VhdGhlcm1hcC5vcmcvZGF0YS8yLjUvZm9yZWNhc3Q/cT0ke2NpdHl9Jm1vZGU9anNvbiZhcHBpZD0yYmQ3NTdmMjNjYTk0OGYxOTUzZGMzZjk5ZDZiM2M1N2A7XG5cbmxldCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsgXG4gICBcbiAgICBhcHAuZm9yY2FzdERhdGEgPSBKU09OLnBhcnNlKHRoaXMucmVzcG9uc2VUZXh0KTtcbiAgICBhcHAuZGVjb250cnVjdERhdGEoYXBwLmZvcmNhc3REYXRhKTtcblxuICB9O1xuXG4gIHhoci5vcGVuKCdHRVQnLCB1cmwsIHRydWUpO1xuICB4aHIuc2VuZCgpO1xuXG5cblxuXG59XG5cblxuXG5hcHAuZGVjb250cnVjdERhdGEgPSAgKGRhdGEpID0+eyBjb25zdCBmaXZlRGF5cyA9IGRhdGEubGlzdCA7XG5cbmxldCBkYXlzID0gW10gO1xuXG5cbmZvciAoIGxldCBjb3VudGVyID0gMDsgY291bnRlciA8IDUgOyBjb3VudGVyKysgKSB7XG4gICAgXG4gIGxldCBtYXJrZXIgPSBhcHAudG9kYXlzRGF0ZS5nZXREYXRlKCkgKyBjb3VudGVyO1xuXG4gIGRheXMucHVzaChmaXZlRGF5cy5maWx0ZXIoZnVuY3Rpb24oZWxlbWVudCl7XG4gXG4gIGxldCBkYXRlID0gbmV3IERhdGUoZWxlbWVudC5kdF90eHQpLmdldERhdGUoKTtcbiAgXG4gIHJldHVybiAgZGF0ZSA9PT0gbWFya2VyIDtcbiAgICBcbiAgfSkpO1xuICAgICAgXG59O1xuXG5hcHAudXBkYXRlRm9yZWNhc3RDYXJkKGFwcC5pbml0aWFsaXNlRm9yZWNhc3QoZGF5cykpO1xuXG59XG5cblxuXG5hcHAuaW5pdGlhbGlzZUZvcmVjYXN0ID0gIChkYXlzKSA9PiB7XG5cblxuXG4gIGxldCBmb3JlY2FzdCA9IFtdO1xuXG4gIGRheXMuZm9yRWFjaCgoZWxlbWVudCxpbmRleCkgPT4ge1xuXG4gIGxldCBtaW4gPSAwLCBtYXggPSAwICwgaXRlbSA9IFwiXCIgLCBjb21wYXJlID0gLTEsIGN1cnJlbnQgPSB7fSx3ZWF0aGVyID1bXSAsY291bnRzID0ge307XG5cbiAgY29uc3QgZGF5QXJyYXkgPSBlbGVtZW50O1xuXG4gIGRheUFycmF5LmZvckVhY2goKGlubmVyRWxlbWVudCxpbmRleCkgPT57XG5cbiAgbGV0IG1hcmtlciA9IGluZGV4KzE7XG4gIFxuICBtYXJrZXIgPCBkYXlBcnJheS5sZW5ndGggPyBhcHAudG9kYXlzRGF0ZSA8PSBuZXcgRGF0ZShpbm5lckVsZW1lbnQuZHRfdHh0KSB8fCBcblxuICAoYXBwLnRvZGF5c0RhdGUgPj0gbmV3IERhdGUoaW5uZXJFbGVtZW50LmR0X3R4dCkgJiYgYXBwLnRvZGF5c0RhdGUgPD0gbmV3IERhdGUoZGF5QXJyYXlbbWFya2VyXS5kdF90eHQpKVxuXG4gID8gIGN1cnJlbnQgPSBpbm5lckVsZW1lbnQgOiBudWxsIDogbnVsbDtcblxuICBpbmRleCA9PT0gMCA/IG1pbiA9IGlubmVyRWxlbWVudC5tYWluLnRlbXBfbWluIDogIFxuICBtaW4gPSBpbm5lckVsZW1lbnQubWFpbi50ZW1wX21pbiA8PSBtaW4gPyBtaW4gOiBpbm5lckVsZW1lbnQubWFpbi50ZW1wX21pbiA7XG5cbiAgaW5kZXggPT09IDAgPyBtYXggPSBpbm5lckVsZW1lbnQubWFpbi50ZW1wX21heCA6XG4gIG1heCA9IGlubmVyRWxlbWVudC5tYWluLnRlbXBfbWF4ID49IG1heCA/IG1heCA6IGlubmVyRWxlbWVudC5tYWluLnRlbXBfbWF4IDtcblxuICBsZXQgY29kZSA9IGlubmVyRWxlbWVudC53ZWF0aGVyWzBdLmljb247XG5cbiAgY291bnRzW2NvZGVdID0gY291bnRzW2NvZGVdID09PSB1bmRlZmluZWQgPyAgMSA6ICBjb3VudHNbY29kZV0gKyAxIDtcblxuICBjb3VudHNbY29kZV0gPiBjb21wYXJlID8gKGNvbXBhcmUgPSBjb3VudHNbY29kZV0gLCBcblxuICBpdGVtID0ge2N1cnJlbnQ6Y3VycmVudCwgY29kZTogaW5uZXJFbGVtZW50LndlYXRoZXJbMF0uaWNvbi5yZXBsYWNlKC9bYS16XS8sJycpICwgXG5cbiAgaGlnaDogKCggbWF4IC0gMjczLjE1KSAqIDkvNSkgKyAzMiAsIFxuXG4gIGxvdzogKCggbWluIC0gMjczLjE1KSAqIDkvNSkgKyAzMiB9ICkgOiBudWxsIDtcblxuICB9KTtcbiAgIFxuICBmb3JlY2FzdC5wdXNoKGl0ZW0pO1xuXG4gIH0pO1xuXG5cbiAgY29uc3QgaW5pdGlhbFdlYXRoZXJGb3JlY2FzdCA9IHtcbiAgXG4gIGtleTogYXBwLmZvcmNhc3REYXRhLmNpdHkuaWQsXG4gICAgbGFiZWw6IGFwcC5mb3JjYXN0RGF0YS5jaXR5Lm5hbWUsXG4gICAgY3JlYXRlZDogbmV3IERhdGUoKSxcbiAgICBjaGFubmVsOiB7XG4gICAgICBhc3Ryb25vbXk6IHtcbiAgICAgICAgc3VucmlzZTogXCJcIixcbiAgICAgICAgc3Vuc2V0OiBcIlwiXG4gICAgICB9LFxuICAgICAgaXRlbToge1xuICAgICAgICBjb25kaXRpb246IHtcbiAgICAgICAgICB0ZXh0OiBmb3JlY2FzdFswXS5jdXJyZW50LndlYXRoZXJbMF0ubWFpbixcbiAgICAgICAgICBkYXRlOiBuZXcgRGF0ZShmb3JlY2FzdFswXS5jdXJyZW50LmR0X3R4dCksXG4gICAgICAgICAgdGVtcDogKCggZm9yZWNhc3RbMF0uY3VycmVudC5tYWluLnRlbXAgLSAyNzMuMTUpICogOS81KSArIDMyLFxuICAgICAgICAgIGNvZGU6IGZvcmVjYXN0WzBdLmN1cnJlbnQud2VhdGhlclswXS5pY29uLnJlcGxhY2UoL1thLXpdLywnJylcbiAgICAgICAgfSxcbiAgICAgIGZvcmVjYXN0OmZvcmVjYXN0XG4gICAgfSxcbiAgICBhdG1vc3BoZXJlOiB7XG4gICAgICAgIGh1bWlkaXR5OiBmb3JlY2FzdFswXS5jdXJyZW50Lm1haW4uaHVtaWRpdHlcbiAgICAgIH0sXG4gICAgICB3aW5kOiB7XG4gICAgICAgIHNwZWVkOiBmb3JlY2FzdFswXS5jdXJyZW50LndpbmQuc3BlZWQsXG4gICAgICAgIGRpcmVjdGlvbjogXCJcIlxuICAgICAgfVxuICAgIH1cbiAgfVxuXG5yZXR1cm4gaW5pdGlhbFdlYXRoZXJGb3JlY2FzdDtcblxufVxuXG5cbmFwcC5nZXRGb3JjYXN0KCdMb25kb24nKTtcblxuXG59KSgpO1xuIl19
