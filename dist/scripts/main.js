'use strict';

(function () {
  'use strict';

  var app = {
    todaysDate: new Date(),
    isLoading: true,
    forcastData: {},
    spinner: document.querySelector('.loader'),
    cardTemplate: document.querySelector('.cardTemplate'),
    container: document.querySelector('.main'),
    daysOfWeek: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
  };

  app.updateForecastCard = function (data) {

    var dataLastUpdated = new Date(data.created);
    var sunrise = data.channel.astronomy.sunrise;
    var sunset = data.channel.astronomy.sunset;
    var current = data.channel.item.condition;
    var humidity = data.channel.atmosphere.humidity;
    var wind = data.channel.wind;
    app.cardTemplate.querySelector('.description').textContent = current.text;
    app.cardTemplate.querySelector('.date').textContent = current.date;
    app.cardTemplate.querySelector('.current .icon').classList.add(app.getIconClass(current.code));
    app.cardTemplate.querySelector('.current .temperature .value').textContent = Math.round(current.temp);
    app.cardTemplate.querySelector('.current .sunrise').textContent = sunrise;
    app.cardTemplate.querySelector('.current .sunset').textContent = sunset;
    app.cardTemplate.querySelector('.current .humidity').textContent = Math.round(humidity) + '%';
    app.cardTemplate.querySelector('.current .wind .value').textContent = Math.round(wind.speed);
    app.cardTemplate.querySelector('.current .wind .direction').textContent = wind.direction;
    var nextDays = cardTemplate.querySelectorAll('.future .oneday');
    var today = new Date();
    today = today.getDay();
    for (var i = 0; i < 5; i++) {
      var nextDay = nextDays[i];
      var daily = data.channel.item.forecast[i];
      if (daily && nextDay) {
        nextDay.querySelector('.date').textContent = app.daysOfWeek[i + today];
        nextDay.querySelector('.icon').classList.add(app.getIconClass(daily.code));
        nextDay.querySelector('.temp-high .value').textContent = Math.round(daily.high);
        nextDay.querySelector('.temp-low .value').textContent = Math.round(daily.low);
      }
    }
    if (app.isLoading) {
      app.spinner.setAttribute('hidden', true);
      app.container.removeAttribute('hidden');
      app.isLoading = false;
    }
  };

  app.getIconClass = function (weatherCode) {
    // Weather codes: https://developer.yahoo.com/weather/documentation.html#codes
    weatherCode = parseInt(weatherCode);
    switch (weatherCode) {
      case 25:
      case 32:
      case 33:
      case 34:
      case 36:
      case 3200:
        return 'clear-day';
      case 0:
      case 1:
      case 2:
      case 6:
      case 8:
      case 9:
      case 10:
      case 11:
      case 12:
      case 17:
      case 35:
      case 40:
        return 'rain';
      case 3:
      case 4:
      case 37:
      case 38:
      case 39:
      case 45:
      case 47:
        return 'thunderstorms';
      case 5:
      case 7:
      case 13:
      case 14:
      case 16:
      case 18:
      case 41:
      case 42:
      case 43:
      case 46:
        return 'snow';
      case 15:
      case 19:
      case 20:
      case 21:
      case 22:
        return 'fog';
      case 24:
      case 23:
        return 'windy';
      case 26:
      case 27:
      case 28:
      case 31:
        return 'cloudy';
      case 29:
      case 30:
      case 44:
        return 'partly-cloudy-day';
    }
  };

  var initialWeatherForecast = {
    key: '2459115',
    label: 'New York, NY',
    created: '2016-07-22T01:00:00Z',
    channel: {
      astronomy: {
        sunrise: "5:43 am",
        sunset: "8:21 pm"
      },
      item: {
        condition: {
          text: "Windy",
          date: "Thu, 21 Jul 2016 09:00 PM EDT",
          temp: 56,
          code: 24
        },
        forecast: [{ code: 44, high: 86, low: 70 }, { code: 44, high: 94, low: 73 }, { code: 4, high: 95, low: 78 }, { code: 24, high: 75, low: 89 }, { code: 24, high: 89, low: 77 }, { code: 44, high: 92, low: 79 }, { code: 44, high: 89, low: 77 }]
      },
      atmosphere: {
        humidity: 56
      },
      wind: {
        speed: 25,
        direction: 195
      }
    }
  };

  app.getForcast = function (city) {

    var url = 'http://api.openweathermap.org/data/2.5/forecast?q=' + city + '&mode=json&appid=2bd757f23ca948f1953dc3f99d6b3c57';

    var xhr = new XMLHttpRequest();
    xhr.onload = function () {

      app.forcastData = JSON.parse(this.responseText);
      app.decontructData(app.forcastData);
    };

    xhr.open('GET', url, true);
    xhr.send();
  };

  app.decontructData = function (data) {
    var fiveDays = data.list;

    var days = [];

    var _loop = function _loop(counter) {

      var marker = app.todaysDate.getDate() + counter;

      days.push(fiveDays.filter(function (element) {

        var date = new Date(element.dt_txt).getDate();

        return date === marker;
      }));
    };

    for (var counter = 0; counter < 5; counter++) {
      _loop(counter);
    };

    app.updateForecastCard(app.initialiseForecast(days));
  };

  app.initialiseForecast = function (days) {

    var forecast = [];

    days.forEach(function (element, index) {

      var min = 0,
          max = 0,
          item = "",
          compare = -1,
          current = {},
          weather = [],
          counts = {};

      var dayArray = element;

      dayArray.forEach(function (innerElement, index) {

        var marker = index + 1;

        marker < dayArray.length ? app.todaysDate <= new Date(innerElement.dt_txt) || app.todaysDate >= new Date(innerElement.dt_txt) && app.todaysDate <= new Date(dayArray[marker].dt_txt) ? current = innerElement : null : null;

        index === 0 ? min = innerElement.main.temp_min : min = innerElement.main.temp_min <= min ? min : innerElement.main.temp_min;

        index === 0 ? max = innerElement.main.temp_max : max = innerElement.main.temp_max >= max ? max : innerElement.main.temp_max;

        var code = innerElement.weather[0].icon;

        counts[code] = counts[code] === undefined ? 1 : counts[code] + 1;

        counts[code] > compare ? (compare = counts[code], item = { current: current, code: innerElement.weather[0].icon.replace(/[a-z]/, ''),

          high: (max - 273.15) * 9 / 5 + 32,

          low: (min - 273.15) * 9 / 5 + 32 }) : null;
      });

      forecast.push(item);
    });

    var initialWeatherForecast = {

      key: app.forcastData.city.id,
      label: app.forcastData.city.name,
      created: new Date(),
      channel: {
        astronomy: {
          sunrise: "",
          sunset: ""
        },
        item: {
          condition: {
            text: forecast[0].current.weather[0].main,
            date: new Date(forecast[0].current.dt_txt),
            temp: (forecast[0].current.main.temp - 273.15) * 9 / 5 + 32,
            code: forecast[0].current.weather[0].icon.replace(/[a-z]/, '')
          },
          forecast: forecast
        },
        atmosphere: {
          humidity: forecast[0].current.main.humidity
        },
        wind: {
          speed: forecast[0].current.wind.speed,
          direction: ""
        }
      }
    };

    return initialWeatherForecast;
  };

  app.getForcast('London');

  //, data => {app.updateForecastCard(decontructData(data));}
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiYXBwIiwidG9kYXlzRGF0ZSIsIkRhdGUiLCJpc0xvYWRpbmciLCJmb3JjYXN0RGF0YSIsInNwaW5uZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjYXJkVGVtcGxhdGUiLCJjb250YWluZXIiLCJkYXlzT2ZXZWVrIiwidXBkYXRlRm9yZWNhc3RDYXJkIiwiZGF0YSIsImRhdGFMYXN0VXBkYXRlZCIsImNyZWF0ZWQiLCJzdW5yaXNlIiwiY2hhbm5lbCIsImFzdHJvbm9teSIsInN1bnNldCIsImN1cnJlbnQiLCJpdGVtIiwiY29uZGl0aW9uIiwiaHVtaWRpdHkiLCJhdG1vc3BoZXJlIiwid2luZCIsInRleHRDb250ZW50IiwidGV4dCIsImRhdGUiLCJjbGFzc0xpc3QiLCJhZGQiLCJnZXRJY29uQ2xhc3MiLCJjb2RlIiwiTWF0aCIsInJvdW5kIiwidGVtcCIsInNwZWVkIiwiZGlyZWN0aW9uIiwibmV4dERheXMiLCJxdWVyeVNlbGVjdG9yQWxsIiwidG9kYXkiLCJnZXREYXkiLCJpIiwibmV4dERheSIsImRhaWx5IiwiZm9yZWNhc3QiLCJoaWdoIiwibG93Iiwic2V0QXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwid2VhdGhlckNvZGUiLCJwYXJzZUludCIsImluaXRpYWxXZWF0aGVyRm9yZWNhc3QiLCJrZXkiLCJsYWJlbCIsImdldEZvcmNhc3QiLCJjaXR5IiwidXJsIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvbmxvYWQiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJkZWNvbnRydWN0RGF0YSIsIm9wZW4iLCJzZW5kIiwiZml2ZURheXMiLCJsaXN0IiwiZGF5cyIsImNvdW50ZXIiLCJtYXJrZXIiLCJnZXREYXRlIiwicHVzaCIsImZpbHRlciIsImVsZW1lbnQiLCJkdF90eHQiLCJpbml0aWFsaXNlRm9yZWNhc3QiLCJmb3JFYWNoIiwiaW5kZXgiLCJtaW4iLCJtYXgiLCJjb21wYXJlIiwid2VhdGhlciIsImNvdW50cyIsImRheUFycmF5IiwiaW5uZXJFbGVtZW50IiwibGVuZ3RoIiwibWFpbiIsInRlbXBfbWluIiwidGVtcF9tYXgiLCJpY29uIiwidW5kZWZpbmVkIiwicmVwbGFjZSIsImlkIiwibmFtZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxDQUFDLFlBQVc7QUFBRTs7QUFFVixNQUFNQSxNQUFNO0FBQ1pDLGdCQUFZLElBQUlDLElBQUosRUFEQTtBQUVaQyxlQUFXLElBRkM7QUFHWkMsaUJBQVksRUFIQTtBQUlaQyxhQUFTQyxTQUFTQyxhQUFULENBQXVCLFNBQXZCLENBSkc7QUFLWkMsa0JBQWNGLFNBQVNDLGFBQVQsQ0FBdUIsZUFBdkIsQ0FMRjtBQU1aRSxlQUFXSCxTQUFTQyxhQUFULENBQXVCLE9BQXZCLENBTkM7QUFPWkcsZ0JBQVksQ0FBRSxLQUFGLEVBQVEsS0FBUixFQUFlLEtBQWYsRUFBc0IsS0FBdEIsRUFBNkIsS0FBN0IsRUFBb0MsS0FBcEMsRUFBMkMsS0FBM0M7QUFQQSxHQUFaOztBQVVBVixNQUFJVyxrQkFBSixHQUF5QixVQUFTQyxJQUFULEVBQWU7O0FBRXhDLFFBQUlDLGtCQUFrQixJQUFJWCxJQUFKLENBQVNVLEtBQUtFLE9BQWQsQ0FBdEI7QUFDQSxRQUFJQyxVQUFVSCxLQUFLSSxPQUFMLENBQWFDLFNBQWIsQ0FBdUJGLE9BQXJDO0FBQ0EsUUFBSUcsU0FBU04sS0FBS0ksT0FBTCxDQUFhQyxTQUFiLENBQXVCQyxNQUFwQztBQUNBLFFBQUlDLFVBQVVQLEtBQUtJLE9BQUwsQ0FBYUksSUFBYixDQUFrQkMsU0FBaEM7QUFDQSxRQUFJQyxXQUFXVixLQUFLSSxPQUFMLENBQWFPLFVBQWIsQ0FBd0JELFFBQXZDO0FBQ0EsUUFBSUUsT0FBT1osS0FBS0ksT0FBTCxDQUFhUSxJQUF4QjtBQUNBeEIsUUFBSVEsWUFBSixDQUFpQkQsYUFBakIsQ0FBK0IsY0FBL0IsRUFBK0NrQixXQUEvQyxHQUE2RE4sUUFBUU8sSUFBckU7QUFDQTFCLFFBQUlRLFlBQUosQ0FBaUJE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c0IsU0FBUyxDQUFULEVBQVl6QixPQUFaLENBQW9Cb0UsSUFBcEIsQ0FBeUJqRTtBQUQzQixTQWRIO0FBaUJQRSxjQUFNO0FBQ0pXLGlCQUFPUyxTQUFTLENBQVQsRUFBWXpCLE9BQVosQ0FBb0JLLElBQXBCLENBQXlCVyxLQUQ1QjtBQUVKQyxxQkFBVztBQUZQO0FBakJDO0FBTG9CLEtBQS9COztBQTZCRixXQUFPZSxzQkFBUDtBQUVDLEdBOUVEOztBQWlGQW5ELE1BQUlzRCxVQUFKLENBQWUsUUFBZjs7QUFFQTtBQUVDLENBblNEIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7ICd1c2Ugc3RyaWN0JztcblxuICAgIGNvbnN0IGFwcCA9IHtcbiAgICB0b2RheXNEYXRlOiBuZXcgRGF0ZSgpLFxuICAgIGlzTG9hZGluZzogdHJ1ZSxcbiAgICBmb3JjYXN0RGF0YTp7fSxcbiAgICBzcGlubmVyOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9hZGVyJyksXG4gICAgY2FyZFRlbXBsYXRlOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZFRlbXBsYXRlJyksXG4gICAgY29udGFpbmVyOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFpbicpLFxuICAgIGRheXNPZldlZWs6IFsgJ1N1bicsJ01vbicsICdUdWUnLCAnV2VkJywgJ1RodScsICdGcmknLCAnU2F0J11cbiAgfTtcblxuICAgIGFwcC51cGRhdGVGb3JlY2FzdENhcmQgPSBmdW5jdGlvbihkYXRhKSB7XG5cbiAgICBsZXQgZGF0YUxhc3RVcGRhdGVkID0gbmV3IERhdGUoZGF0YS5jcmVhdGVkKTtcbiAgICBsZXQgc3VucmlzZSA9IGRhdGEuY2hhbm5lbC5hc3Ryb25vbXkuc3VucmlzZTtcbiAgICBsZXQgc3Vuc2V0ID0gZGF0YS5jaGFubmVsLmFzdHJvbm9teS5zdW5zZXQ7XG4gICAgbGV0IGN1cnJlbnQgPSBkYXRhLmNoYW5uZWwuaXRlbS5jb25kaXRpb247XG4gICAgbGV0IGh1bWlkaXR5ID0gZGF0YS5jaGFubmVsLmF0bW9zcGhlcmUuaHVtaWRpdHk7XG4gICAgbGV0IHdpbmQgPSBkYXRhLmNoYW5uZWwud2luZDtcbiAgICBhcHAuY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpLnRleHRDb250ZW50ID0gY3VycmVudC50ZXh0O1xuICAgIGFwcC5jYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcignLmRhdGUnKS50ZXh0Q29udGVudCA9IGN1cnJlbnQuZGF0ZTtcbiAgICBhcHAuY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5jdXJyZW50IC5pY29uJykuY2xhc3NMaXN0LmFkZChhcHAuZ2V0SWNvbkNsYXNzKGN1cnJlbnQuY29kZSkpO1xuICAgIGFwcC5jYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcignLmN1cnJlbnQgLnRlbXBlcmF0dXJlIC52YWx1ZScpLnRleHRDb250ZW50ID1cbiAgICAgIE1hdGgucm91bmQoY3VycmVudC50ZW1wKTtcbiAgICBhcHAuY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5jdXJyZW50IC5zdW5yaXNlJykudGV4dENvbnRlbnQgPSBzdW5yaXNlO1xuICAgIGFwcC5jYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcignLmN1cnJlbnQgLnN1bnNldCcpLnRleHRDb250ZW50ID0gc3Vuc2V0O1xuICAgIGFwcC5jYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcignLmN1cnJlbnQgLmh1bWlkaXR5JykudGV4dENvbnRlbnQgPVxuICAgICAgTWF0aC5yb3VuZChodW1pZGl0eSkgKyAnJSc7XG4gICAgYXBwLmNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKCcuY3VycmVudCAud2luZCAudmFsdWUnKS50ZXh0Q29udGVudCA9XG4gICAgICBNYXRoLnJvdW5kKHdpbmQuc3BlZWQpO1xuICAgIGFwcC5jYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcignLmN1cnJlbnQgLndpbmQgLmRpcmVjdGlvbicpLnRleHRDb250ZW50ID0gd2luZC5kaXJlY3Rpb247XG4gICAgbGV0IG5leHREYXlzID0gY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3JBbGwoJy5mdXR1cmUgLm9uZWRheScpO1xuICAgIGxldCB0b2RheSA9IG5ldyBEYXRlKCk7XG4gICAgdG9kYXkgPSB0b2RheS5nZXREYXkoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgbGV0IG5leHREYXkgPSBuZXh0RGF5c1tpXTtcbiAgICAgIGxldCBkYWlseSA9IGRhdGEuY2hhbm5lbC5pdGVtLmZvcmVjYXN0W2ldO1xuICAgICAgaWYgKGRhaWx5ICYmIG5leHREYXkpIHtcbiAgICAgICAgbmV4dERheS5xdWVyeVNlbGVjdG9yKCcuZGF0ZScpLnRleHRDb250ZW50ID1cbiAgICAgICAgICBhcHAuZGF5c09mV2Vla1soaSArIHRvZGF5KV07XG4gICAgICAgIG5leHREYXkucXVlcnlTZWxlY3RvcignLmljb24nKS5jbGFzc0xpc3QuYWRkKGFwcC5nZXRJY29uQ2xhc3MoZGFpbHkuY29kZSkpO1xuICAgICAgICBuZXh0RGF5LnF1ZXJ5U2VsZWN0b3IoJy50ZW1wLWhpZ2ggLnZhbHVlJykudGV4dENvbnRlbnQgPVxuICAgICAgICAgIE1hdGgucm91bmQoZGFpbHkuaGlnaCk7XG4gICAgICAgIG5leHREYXkucXVlcnlTZWxlY3RvcignLnRlbXAtbG93IC52YWx1ZScpLnRleHRDb250ZW50ID1cbiAgICAgICAgICBNYXRoLnJvdW5kKGRhaWx5Lmxvdyk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChhcHAuaXNMb2FkaW5nKSB7XG4gICAgICBhcHAuc3Bpbm5lci5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsIHRydWUpO1xuICAgICAgYXBwLmNvbnRhaW5lci5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuICAgICAgYXBwLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgIH1cbiAgfTtcblxuYXBwLmdldEljb25DbGFzcyA9IGZ1bmN0aW9uKHdlYXRoZXJDb2RlKSB7XG4gICAgLy8gV2VhdGhlciBjb2RlczogaHR0cHM6Ly9kZXZlbG9wZXIueWFob28uY29tL3dlYXRoZXIvZG9jdW1lbnRhdGlvbi5odG1sI2NvZGVzXG4gICAgd2VhdGhlckNvZGUgPSBwYXJzZUludCh3ZWF0aGVyQ29kZSk7XG4gICAgc3dpdGNoICh3ZWF0aGVyQ29kZSkge1xuICAgICAgY2FzZSAyNTogXG4gICAgICBjYXNlIDMyOiBcbiAgICAgIGNhc2UgMzM6IFxuICAgICAgY2FzZSAzNDogXG4gICAgICBjYXNlIDM2OiBcbiAgICAgIGNhc2UgMzIwMDogXG4gICAgICAgIHJldHVybiAnY2xlYXItZGF5JztcbiAgICAgIGNhc2UgMDogXG4gICAgICBjYXNlIDE6IFxuICAgICAgY2FzZSAyOiBcbiAgICAgIGNhc2UgNjogXG4gICAgICBjYXNlIDg6IFxuICAgICAgY2FzZSA5OiBcbiAgICAgIGNhc2UgMTA6IFxuICAgICAgY2FzZSAxMTogXG4gICAgICBjYXNlIDEyOiBcbiAgICAgIGNhc2UgMTc6IFxuICAgICAgY2FzZSAzNTogXG4gICAgICBjYXNlIDQwOiBcbiAgICAgICAgcmV0dXJuICdyYWluJztcbiAgICAgIGNhc2UgMzpcbiAgICAgIGNhc2UgNDpcbiAgICAgIGNhc2UgMzc6IFxuICAgICAgY2FzZSAzODogXG4gICAgICBjYXNlIDM5OiBcbiAgICAgIGNhc2UgNDU6IFxuICAgICAgY2FzZSA0NzpcbiAgICAgICAgcmV0dXJuICd0aHVuZGVyc3Rvcm1zJztcbiAgICAgIGNhc2UgNTogXG4gICAgICBjYXNlIDc6IFxuICAgICAgY2FzZSAxMzogXG4gICAgICBjYXNlIDE0OiBcbiAgICAgIGNhc2UgMTY6IFxuICAgICAgY2FzZSAxODogXG4gICAgICBjYXNlIDQxOiBcbiAgICAgIGNhc2UgNDI6IFxuICAgICAgY2FzZSA0MzogXG4gICAgICBjYXNlIDQ2OiBcbiAgICAgICAgcmV0dXJuICdzbm93JztcbiAgICAgIGNhc2UgMTU6IFxuICAgICAgY2FzZSAxOTogXG4gICAgICBjYXNlIDIwOiBcbiAgICAgIGNhc2UgMjE6IFxuICAgICAgY2FzZSAyMjogXG4gICAgICAgIHJldHVybiAnZm9nJztcbiAgICAgIGNhc2UgMjQ6IFxuICAgICAgY2FzZSAyMzogXG4gICAgICAgIHJldHVybiAnd2luZHknO1xuICAgICAgY2FzZSAyNjogXG4gICAgICBjYXNlIDI3OiBcbiAgICAgIGNhc2UgMjg6IFxuICAgICAgY2FzZSAzMTogXG4gICAgICAgIHJldHVybiAnY2xvdWR5JztcbiAgICAgIGNhc2UgMjk6IFxuICAgICAgY2FzZSAzMDogXG4gICAgICBjYXNlIDQ0OiBcbiAgICAgICAgcmV0dXJuICdwYXJ0bHktY2xvdWR5LWRheSc7XG4gICAgfVxuICB9O1xuXG5cblxuICB2YXIgaW5pdGlhbFdlYXRoZXJGb3JlY2FzdCA9IHtcbiAgICBrZXk6ICcyNDU5MTE1JyxcbiAgICBsYWJlbDogJ05ldyBZb3JrLCBOWScsXG4gICAgY3JlYXRlZDogJzIwMTYtMDctMjJUMDE6MDA6MDBaJyxcbiAgICBjaGFubmVsOiB7XG4gICAgICBhc3Ryb25vbXk6IHtcbiAgICAgICAgc3VucmlzZTogXCI1OjQzIGFtXCIsXG4gICAgICAgIHN1bnNldDogXCI4OjIxIHBtXCJcbiAgICAgIH0sXG4gICAgICBpdGVtOiB7XG4gICAgICAgIGNvbmRpdGlvbjoge1xuICAgICAgICAgIHRleHQ6IFwiV2luZHlcIixcbiAgICAgICAgICBkYXRlOiBcIlRodSwgMjEgSnVsIDIwMTYgMDk6MDAgUE0gRURUXCIsXG4gICAgICAgICAgdGVtcDogNTYsXG4gICAgICAgICAgY29kZTogMjRcbiAgICAgICAgfSxcbiAgICAgICAgZm9yZWNhc3Q6IFtcbiAgICAgICAgICB7Y29kZTogNDQsIGhpZ2g6IDg2LCBsb3c6IDcwfSxcbiAgICAgICAgICB7Y29kZTogNDQsIGhpZ2g6IDk0LCBsb3c6IDczfSxcbiAgICAgICAgICB7Y29kZTogNCwgaGlnaDogOTUsIGxvdzogNzh9LFxuICAgICAgICAgIHtjb2RlOiAyNCwgaGlnaDogNzUsIGxvdzogODl9LFxuICAgICAgICAgIHtjb2RlOiAyNCwgaGlnaDogODksIGxvdzogNzd9LFxuICAgICAgICAgIHtjb2RlOiA0NCwgaGlnaDogOTIsIGxvdzogNzl9LFxuICAgICAgICAgIHtjb2RlOiA0NCwgaGlnaDogODksIGxvdzogNzd9XG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICBhdG1vc3BoZXJlOiB7XG4gICAgICAgIGh1bWlkaXR5OiA1NlxuICAgICAgfSxcbiAgICAgIHdpbmQ6IHtcbiAgICAgICAgc3BlZWQ6IDI1LFxuICAgICAgICBkaXJlY3Rpb246IDE5NVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuXG5hcHAuZ2V0Rm9yY2FzdCA9IGZ1bmN0aW9uKGNpdHkpIHtcblxuXG5sZXQgdXJsID0gYGh0dHA6Ly9hcGkub3BlbndlYXRoZXJtYXAub3JnL2RhdGEvMi41L2ZvcmVjYXN0P3E9JHtjaXR5fSZtb2RlPWpzb24mYXBwaWQ9MmJkNzU3ZjIzY2E5NDhmMTk1M2RjM2Y5OWQ2YjNjNTdgO1xuXG5sZXQgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gIHhoci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7IFxuICAgXG4gICAgYXBwLmZvcmNhc3REYXRhID0gSlNPTi5wYXJzZSh0aGlzLnJlc3BvbnNlVGV4dCk7XG4gICAgYXBwLmRlY29udHJ1Y3REYXRhKGFwcC5mb3JjYXN0RGF0YSk7XG5cbiAgfTtcblxuICB4aHIub3BlbignR0VUJywgdXJsLCB0cnVlKTtcbiAgeGhyLnNlbmQoKTtcblxuXG5cblxufVxuXG5cblxuYXBwLmRlY29udHJ1Y3REYXRhID0gZnVuY3Rpb24gKGRhdGEpIHsgY29uc3QgZml2ZURheXMgPSBkYXRhLmxpc3QgO1xuXG5sZXQgZGF5cyA9IFtdIDtcblxuXG5mb3IgKCBsZXQgY291bnRlciA9IDA7IGNvdW50ZXIgPCA1IDsgY291bnRlcisrICkge1xuICAgIFxuICBsZXQgbWFya2VyID0gYXBwLnRvZGF5c0RhdGUuZ2V0RGF0ZSgpICsgY291bnRlcjtcblxuICBkYXlzLnB1c2goZml2ZURheXMuZmlsdGVyKGZ1bmN0aW9uKGVsZW1lbnQpe1xuIFxuICBsZXQgZGF0ZSA9IG5ldyBEYXRlKGVsZW1lbnQuZHRfdHh0KS5nZXREYXRlKCk7XG4gIFxuICByZXR1cm4gIGRhdGUgPT09IG1hcmtlciA7XG4gICAgXG4gIH0pKTtcbiAgICAgIFxufTtcblxuYXBwLnVwZGF0ZUZvcmVjYXN0Q2FyZChhcHAuaW5pdGlhbGlzZUZvcmVjYXN0KGRheXMpKTtcblxufVxuXG5cblxuYXBwLmluaXRpYWxpc2VGb3JlY2FzdCA9IGZ1bmN0aW9uIChkYXlzKSB7XG5cblxuXG4gIGxldCBmb3JlY2FzdCA9IFtdO1xuXG4gIGRheXMuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50LGluZGV4KSB7XG5cbiAgbGV0IG1pbiA9IDAsIG1heCA9IDAgLCBpdGVtID0gXCJcIiAsIGNvbXBhcmUgPSAtMSwgY3VycmVudCA9IHt9LHdlYXRoZXIgPVtdICxjb3VudHMgPSB7fTtcblxuICBjb25zdCBkYXlBcnJheSA9IGVsZW1lbnQ7XG5cbiAgZGF5QXJyYXkuZm9yRWFjaChmdW5jdGlvbihpbm5lckVsZW1lbnQsaW5kZXgpe1xuXG4gIGxldCBtYXJrZXIgPSBpbmRleCsxO1xuICBcbiAgbWFya2VyIDwgZGF5QXJyYXkubGVuZ3RoID8gYXBwLnRvZGF5c0RhdGUgPD0gbmV3IERhdGUoaW5uZXJFbGVtZW50LmR0X3R4dCkgfHwgXG5cbiAgKGFwcC50b2RheXNEYXRlID49IG5ldyBEYXRlKGlubmVyRWxlbWVudC5kdF90eHQpICYmIGFwcC50b2RheXNEYXRlIDw9IG5ldyBEYXRlKGRheUFycmF5W21hcmtlcl0uZHRfdHh0KSlcblxuICA/ICBjdXJyZW50ID0gaW5uZXJFbGVtZW50IDogbnVsbCA6IG51bGw7XG5cbiAgaW5kZXggPT09IDAgPyBtaW4gPSBpbm5lckVsZW1lbnQubWFpbi50ZW1wX21pbiA6ICBcbiAgbWluID0gaW5uZXJFbGVtZW50Lm1haW4udGVtcF9taW4gPD0gbWluID8gbWluIDogaW5uZXJFbGVtZW50Lm1haW4udGVtcF9taW4gO1xuXG4gIGluZGV4ID09PSAwID8gbWF4ID0gaW5uZXJFbGVtZW50Lm1haW4udGVtcF9tYXggOlxuICBtYXggPSBpbm5lckVsZW1lbnQubWFpbi50ZW1wX21heCA+PSBtYXggPyBtYXggOiBpbm5lckVsZW1lbnQubWFpbi50ZW1wX21heCA7XG5cbiAgbGV0IGNvZGUgPSBpbm5lckVsZW1lbnQud2VhdGhlclswXS5pY29uO1xuXG4gIGNvdW50c1tjb2RlXSA9IGNvdW50c1tjb2RlXSA9PT0gdW5kZWZpbmVkID8gIDEgOiAgY291bnRzW2NvZGVdICsgMSA7XG5cbiAgY291bnRzW2NvZGVdID4gY29tcGFyZSA/IChjb21wYXJlID0gY291bnRzW2NvZGVdICwgXG5cbiAgaXRlbSA9IHtjdXJyZW50OmN1cnJlbnQsIGNvZGU6IGlubmVyRWxlbWVudC53ZWF0aGVyWzBdLmljb24ucmVwbGFjZSgvW2Etel0vLCcnKSAsIFxuXG4gIGhpZ2g6ICgoIG1heCAtIDI3My4xNSkgKiA5LzUpICsgMzIgLCBcblxuICBsb3c6ICgoIG1pbiAtIDI3My4xNSkgKiA5LzUpICsgMzIgfSApIDogbnVsbCA7XG5cbiAgfSk7XG4gICBcbiAgZm9yZWNhc3QucHVzaChpdGVtKTtcblxuICB9KTtcblxuXG4gIGNvbnN0IGluaXRpYWxXZWF0aGVyRm9yZWNhc3QgPSB7XG4gIFxuICBrZXk6IGFwcC5mb3JjYXN0RGF0YS5jaXR5LmlkLFxuICAgIGxhYmVsOiBhcHAuZm9yY2FzdERhdGEuY2l0eS5uYW1lLFxuICAgIGNyZWF0ZWQ6IG5ldyBEYXRlKCksXG4gICAgY2hhbm5lbDoge1xuICAgICAgYXN0cm9ub215OiB7XG4gICAgICAgIHN1bnJpc2U6IFwiXCIsXG4gICAgICAgIHN1bnNldDogXCJcIlxuICAgICAgfSxcbiAgICAgIGl0ZW06IHtcbiAgICAgICAgY29uZGl0aW9uOiB7XG4gICAgICAgICAgdGV4dDogZm9yZWNhc3RbMF0uY3VycmVudC53ZWF0aGVyWzBdLm1haW4sXG4gICAgICAgICAgZGF0ZTogbmV3IERhdGUoZm9yZWNhc3RbMF0uY3VycmVudC5kdF90eHQpLFxuICAgICAgICAgIHRlbXA6ICgoIGZvcmVjYXN0WzBdLmN1cnJlbnQubWFpbi50ZW1wIC0gMjczLjE1KSAqIDkvNSkgKyAzMixcbiAgICAgICAgICBjb2RlOiBmb3JlY2FzdFswXS5jdXJyZW50LndlYXRoZXJbMF0uaWNvbi5yZXBsYWNlKC9bYS16XS8sJycpXG4gICAgICAgIH0sXG4gICAgICBmb3JlY2FzdDpmb3JlY2FzdFxuICAgIH0sXG4gICAgYXRtb3NwaGVyZToge1xuICAgICAgICBodW1pZGl0eTogZm9yZWNhc3RbMF0uY3VycmVudC5tYWluLmh1bWlkaXR5XG4gICAgICB9LFxuICAgICAgd2luZDoge1xuICAgICAgICBzcGVlZDogZm9yZWNhc3RbMF0uY3VycmVudC53aW5kLnNwZWVkLFxuICAgICAgICBkaXJlY3Rpb246IFwiXCJcbiAgICAgIH1cbiAgICB9XG4gIH1cblxucmV0dXJuIGluaXRpYWxXZWF0aGVyRm9yZWNhc3Q7XG5cbn1cblxuXG5hcHAuZ2V0Rm9yY2FzdCgnTG9uZG9uJyk7XG5cbi8vLCBkYXRhID0+IHthcHAudXBkYXRlRm9yZWNhc3RDYXJkKGRlY29udHJ1Y3REYXRhKGRhdGEpKTt9XG5cbn0pKCk7XG4iXX0=
